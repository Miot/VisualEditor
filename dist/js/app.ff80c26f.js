(function(){"use strict";var e={3143:function(e,t,n){var r=n(9242),o=n(3396);const s={class:"app"};function l(e,t,n,r,l,a){const u=(0,o.up)("VisualEditor");return(0,o.wg)(),(0,o.iD)("div",s,[(0,o.Wm)(u,{modelValue:r.state,"onUpdate:modelValue":t[0]||(t[0]=e=>r.state=e)},null,8,["modelValue"])])}var a=n(4870),u=JSON.parse('{"container":{"width":"550","height":"550"},"blocks":[{"top":100,"left":100,"zIndex":1,"type":"text"},{"top":200,"left":100,"zIndex":1,"type":"button"},{"top":300,"left":100,"zIndex":1,"type":"input"}]}'),i=(0,o.aZ)({props:{data:{type:Object}},setup(e){const t=(0,a.qj)(e?.data),n=(0,o.Fl)((()=>({top:`${e.data.top}px`,left:`${e.data.left}px`,zIndex:`${e.data.zIndex}`}))),r=(0,o.f3)("config"),s=(0,a.iH)(null),l=(0,a.iH)(e.data.alignCenter);return(0,o.bv)((()=>{const{offsetWidth:e,offsetHeight:n}=s.value;l.value&&(t.left-=e/2,t.top-=n/2,l.value=!1),t.width=e,t.height=n})),()=>{const t=r.componentMap[e.data.type],l=t?.render();return(0,o.Wm)("div",{class:"editor-block",style:n.value,ref:s},[l])}}}),d=n(390),c=(n(7658),n(1373));const p=(0,c.Z)();function f(e,t){let n=null;const r=e=>{e.dataTransfer.dropEffect="move"},o=e=>{e.preventDefault()},s=e=>{e.dataTransfer.dropEffect="none"},l=e=>{t.value.blocks.push({top:e.offsetY,left:e.offsetX,zIndex:1,type:n.type,alignCenter:!0})},a=(t,a)=>{n=a;const u=e.value;u.addEventListener("dragenter",r),u.addEventListener("dragover",o),u.addEventListener("dragleave",s),u.addEventListener("drop",l),p.emit("start")},u=()=>{const t=e.value;t.removeEventListener("dragenter",r),t.removeEventListener("dragover",o),t.removeEventListener("dragleave",s),t.removeEventListener("drop",l),p.emit("end")};return{dragstart:a,dragend:u}}function v(e){const t=(0,a.iH)(-1),n=(0,o.Fl)((()=>e.value.blocks[t.value])),r=(0,o.Fl)((()=>({selected:e.value.blocks.filter((e=>e.selected)),unselected:e.value.blocks.filter((e=>!e.selected))}))),s=(e,n,o)=>{e.preventDefault(),e.stopPropagation();const s=r.value.selected.length;e.shiftKey?n.selected=!n.selected:n.selected||(s>=1&&l(),n.selected=!0),t.value=o,d(e)},l=()=>{e.value.blocks.forEach((e=>e.selected=!1))};let u={startX:0,startY:0,dragging:!1},i=(0,a.qj)({x:null,y:null});const d=t=>{const{width:o,height:s}=n.value;u={dragging:!1,startX:t.clientX,startY:t.clientY,startLeft:n.value.left,startTop:n.value.top,startPos:r.value.selected.map((({top:e,left:t})=>({top:e,left:t}))),lines:(()=>{const{unselected:t}=r.value;let n={x:[],y:[]};return[...t,{top:0,left:0,width:e.value.container.width,height:e.value.container.height}].forEach((e=>{const{top:t,left:r,width:l,height:a}=e;n.y.push({showTop:t,top:t}),n.y.push({showTop:t,top:t-s}),n.y.push({showTop:t+a/2,top:t+a/2-s/2}),n.y.push({showTop:t+a,top:t+a}),n.y.push({showTop:t+a,top:t+a-s}),n.x.push({showLeft:r,left:r}),n.x.push({showLeft:r+l,left:r+l}),n.x.push({showLeft:r+l/2,left:r+l/2-o/2}),n.x.push({showLeft:r+l,left:r+l-o}),n.x.push({showLeft:r,left:r-o})})),n})()},document.addEventListener("mousemove",c),document.addEventListener("mouseup",f)},c=t=>{let{clientX:n,clientY:r}=t;u.dragging||(u.dragging=!0,p.emit("start"));const o=n-u.startX+u.startLeft,s=r-u.startY+u.startTop;let l=null,a=null;const d=u.lines;for(let e=0;e<d.y.length;e++){const{showTop:t,top:n}=d.y[e];if(Math.abs(n-s)<5){l=t,r=u.startY-u.startTop+n;break}}for(let e=0;e<d.x.length;e++){const{showLeft:t,left:r}=d.x[e];if(Math.abs(r-o)<5){a=t,n=u.startX-u.startLeft+r;break}}i.x=a,i.y=l;const c=n-u.startX,f=r-u.startY;e.value.blocks.filter((e=>e.selected)).forEach(((e,t)=>{e.top=u.startPos[t].top+f,e.left=u.startPos[t].left+c}))},f=e=>{document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",f),i.x=null,i.y=null,u.dragging&&(p.emit("end"),u.dragging=!1)};return{blcokMousedown:s,clearMousedown:l,markLine:i}}function m(e){const t=(0,a.qj)(e),n={curr:-1,queue:[],commands:{},commandsArr:[],destroyArr:[]},r=e=>{n.commandsArr.push(e),n.commands[e.name]=()=>{const{redo:t,undo:r}=e.execute();if(t(),!e.pushQueue)return;let{curr:o,queue:s}=n;s.length&&(s=s.slice(0,o+1),n.queue=s),s.push({redo:t,undo:r}),n.curr=o+1}};r({name:"redo",keyboard:"ctrl+y",execute(){return{redo(){const e=n.queue[n.curr+1];e&&(e.redo&&e.redo(),n.curr++)}}}}),r({name:"undo",keyboard:"ctrl+z",execute(){return{redo(){if(-1===n.curr)return;const e=n.queue[n.curr];e&&(e.undo&&e.undo(),n.curr--)}}}}),r({name:"drag",pushQueue:!0,init(){this.before=[];const e=()=>{this.before=(0,d.Z)(t.value.blocks)},r=()=>n.commands.drag();return p.on("start",e),p.on("end",r),()=>{p.off("start"),p.off("end")}},execute(){const e=this.before,n=t.value.blocks;return{redo(){t.value.blocks=[...n]},undo(){t.value.blocks=[...e]}}}});const s=(()=>{const e={90:"z",89:"y"},t=t=>{const{ctrlKey:r,keyCode:o}=t;let s=[];r&&s.push("ctrl"),s.push(e[o]),s=s.join("+"),n.commandsArr.forEach((({keyboard:e,name:r})=>{e&&e===s&&(n.commands[r](),t.preventDefault())}))},r=()=>(window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)});return r})();return(()=>{n.destroyArr.push(s()),n.commandsArr.forEach((e=>e.init&&n.destroyArr.push(e.init())))})(),(0,o.Ah)((()=>{n.destroyArr.forEach((e=>e&&e()))})),n}var h=(0,o.aZ)({props:{modelValue:{type:Object}},emits:["update:modelValue"],components:{EditorBlock:i},setup(e,t){const n=(0,o.f3)("config"),r=(0,o.Fl)({get(){return e.modelValue},set(e){t.emit("update:modelValue",(0,d.Z)(e))}}),s=(0,o.Fl)((()=>({width:r.value.container.width+"px",height:r.value.container.height+"px"}))),l=(0,a.iH)(null),{dragstart:u,dragend:c}=f(l,r),{blcokMousedown:p,clearMousedown:h,markLine:g}=v(r),{commands:b}=m(r),y=[{label:"上一步",handler:()=>b.undo()},{label:"撤销上一步",handler:()=>b.redo()}];return()=>(0,o.Wm)("div",{class:"editor"},[(0,o.Wm)("div",{class:"editor-left"},[n.componentList.map((e=>(0,o.Wm)("div",{class:"preview-item",draggable:!0,onDragstart:t=>u(t,e),onDragend:c},[(0,o.Wm)("span",{class:"name"},[e.label]),(0,o.Wm)("div",{class:"component"},[e.preview()])])))]),(0,o.Wm)("div",{class:"editor-top"},[y.map((e=>(0,o.Wm)("div",{class:"editor-top-button",onClick:e.handler},[(0,o.Wm)("span",null,[e.label])])))]),(0,o.Wm)("div",{class:"editor-right"},[(0,o.Uk)("右侧")]),(0,o.Wm)("div",{class:"editor-container"},[(0,o.Wm)("div",{class:"editor-canvas"},[(0,o.Wm)("div",{class:"editor-canvas-content",style:s.value,ref:l,onmousedown:h},[r.value.blocks.map(((e,t)=>(0,o.Wm)(i,{class:e.selected?"editor-block-selected":"",data:e,onmousedown:n=>p(n,e,t)},null))),null!==g.x&&(0,o.Wm)("div",{class:"line-x",style:{left:g.x+"px"}},null),null!==g.y&&(0,o.Wm)("div",{class:"line-y",style:{top:g.y+"px"}},null)])])])])}});function g(){const e=[],t={};return{componentList:e,componentMap:t,register:n=>{e.push(n),t[n.type]=n}}}const b=g();b.register({label:"文本",preview:()=>"预览文本",render:()=>"渲染文本",type:"text"}),b.register({label:"按钮",preview:()=>(0,o.Wm)("button",null,[(0,o.Uk)("预览按钮")]),render:()=>(0,o.Wm)("button",null,[(0,o.Uk)("渲染按钮")]),type:"button"}),b.register({label:"输入框",preview:()=>(0,o.Wm)("input",{placeholder:"预览输入框"},null),render:()=>(0,o.Wm)("input",{placeholder:"渲染输入框"},null),type:"input"});var y={components:{VisualEditor:h},setup(){const e=(0,a.iH)(u);return(0,o.JJ)("config",b),{state:e}}},w=n(89);const x=(0,w.Z)(y,[["render",l]]);var k=x;(0,r.ri)(k).mount("#app")}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,n),s.exports}n.m=e,function(){var e=[];n.O=function(t,r,o,s){if(!r){var l=1/0;for(d=0;d<e.length;d++){r=e[d][0],o=e[d][1],s=e[d][2];for(var a=!0,u=0;u<r.length;u++)(!1&s||l>=s)&&Object.keys(n.O).every((function(e){return n.O[e](r[u])}))?r.splice(u--,1):(a=!1,s<l&&(l=s));if(a){e.splice(d--,1);var i=o();void 0!==i&&(t=i)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[r,o,s]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,r){var o,s,l=r[0],a=r[1],u=r[2],i=0;if(l.some((function(t){return 0!==e[t]}))){for(o in a)n.o(a,o)&&(n.m[o]=a[o]);if(u)var d=u(n)}for(t&&t(r);i<l.length;i++)s=l[i],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(d)},r=self["webpackChunkvisual_editor"]=self["webpackChunkvisual_editor"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=n.O(void 0,[998],(function(){return n(3143)}));r=n.O(r)})();