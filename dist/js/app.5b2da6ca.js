(function(){"use strict";var e={9717:function(e,t,n){var o=n(9242),r=n(3396);const s={class:"app"};function a(e,t,n,o,a,l){const u=(0,r.up)("VisualEditor");return(0,r.wg)(),(0,r.iD)("div",s,[(0,r.Wm)(u,{modelValue:o.state,"onUpdate:modelValue":t[0]||(t[0]=e=>o.state=e)},null,8,["modelValue"])])}var l=n(4870),u=JSON.parse('{"container":{"width":"550","height":"550"},"blocks":[{"top":100,"left":100,"zIndex":1,"type":"text"},{"top":200,"left":100,"zIndex":1,"type":"button"},{"top":300,"left":100,"zIndex":1,"type":"input"}]}'),i=(0,r.aZ)({props:{data:{type:Object}},setup(e){const t=(0,l.qj)(e?.data),n=(0,r.Fl)((()=>({top:`${e.data.top}px`,left:`${e.data.left}px`,zIndex:`${e.data.zIndex}`}))),o=(0,r.f3)("config"),s=(0,l.iH)(null),a=(0,l.iH)(e.data.alignCenter);return(0,r.bv)((()=>{const{offsetWidth:e,offsetHeight:n}=s.value;a.value&&(t.left-=e/2,t.top-=n/2,a.value=!1),t.width=e,t.height=n})),()=>{const t=o.componentMap[e.data.type],a=t?.render();return(0,r.Wm)("div",{class:"editor-block",style:n.value,ref:s},[a])}}}),c=n(390),d=(n(7658),n(1373));const p=(0,d.Z)();function f(e,t){let n=null;const o=e=>{e.dataTransfer.dropEffect="move"},r=e=>{e.preventDefault()},s=e=>{e.dataTransfer.dropEffect="none"},a=e=>{t.value.blocks.push({top:e.offsetY,left:e.offsetX,zIndex:1,type:n.type,alignCenter:!0})},l=(t,l)=>{n=l;const u=e.value;u.addEventListener("dragenter",o),u.addEventListener("dragover",r),u.addEventListener("dragleave",s),u.addEventListener("drop",a),p.emit("start")},u=()=>{const t=e.value;t.removeEventListener("dragenter",o),t.removeEventListener("dragover",r),t.removeEventListener("dragleave",s),t.removeEventListener("drop",a),p.emit("end")};return{dragstart:l,dragend:u}}function m(e){const t=(0,l.iH)(-1),n=(0,r.Fl)((()=>e.value.blocks[t.value])),o=(0,r.Fl)((()=>({selected:e.value.blocks.filter((e=>e.selected)),unselected:e.value.blocks.filter((e=>!e.selected))}))),s=(e,n,r)=>{e.preventDefault(),e.stopPropagation();const s=o.value.selected.length;e.shiftKey?n.selected=!n.selected:n.selected||(s>=1&&a(),n.selected=!0),t.value=r,c(e)},a=()=>{e.value.blocks.forEach((e=>e.selected=!1))};let u={startX:0,startY:0,dragging:!1},i=(0,l.qj)({x:null,y:null});const c=t=>{const{width:r,height:s}=n.value;u={dragging:!1,startX:t.clientX,startY:t.clientY,startLeft:n.value.left,startTop:n.value.top,startPos:o.value.selected.map((({top:e,left:t})=>({top:e,left:t}))),lines:(()=>{const{unselected:t}=o.value;let n={x:[],y:[]};return[...t,{top:0,left:0,width:e.value.container.width,height:e.value.container.height}].forEach((e=>{const{top:t,left:o,width:a,height:l}=e;n.y.push({showTop:t,top:t}),n.y.push({showTop:t,top:t-s}),n.y.push({showTop:t+l/2,top:t+l/2-s/2}),n.y.push({showTop:t+l,top:t+l}),n.y.push({showTop:t+l,top:t+l-s}),n.x.push({showLeft:o,left:o}),n.x.push({showLeft:o+a,left:o+a}),n.x.push({showLeft:o+a/2,left:o+a/2-r/2}),n.x.push({showLeft:o+a,left:o+a-r}),n.x.push({showLeft:o,left:o-r})})),n})()},document.addEventListener("mousemove",d),document.addEventListener("mouseup",f)},d=t=>{let{clientX:n,clientY:o}=t;u.dragging||(u.dragging=!0,p.emit("start"));const r=n-u.startX+u.startLeft,s=o-u.startY+u.startTop;let a=null,l=null;const c=u.lines;for(let e=0;e<c.y.length;e++){const{showTop:t,top:n}=c.y[e];if(Math.abs(n-s)<5){a=t,o=u.startY-u.startTop+n;break}}for(let e=0;e<c.x.length;e++){const{showLeft:t,left:o}=c.x[e];if(Math.abs(o-r)<5){l=t,n=u.startX-u.startLeft+o;break}}i.x=l,i.y=a;const d=n-u.startX,f=o-u.startY;e.value.blocks.filter((e=>e.selected)).forEach(((e,t)=>{e.top=u.startPos[t].top+f,e.left=u.startPos[t].left+d}))},f=e=>{document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",f),i.x=null,i.y=null,u.dragging&&(p.emit("end"),u.dragging=!1)};return{blcokMousedown:s,clearMousedown:a,markLine:i}}function v(e){const t=(0,l.qj)(e),n={curr:-1,queue:[],commands:{},commandsArr:[],destroyArr:[]},o=e=>{n.commandsArr.push(e),n.commands[e.name]=(...t)=>{const{redo:o,undo:r}=e.execute(...t);if(o(),!e.pushQueue)return;let{curr:s,queue:a}=n;a.length&&(a=a.slice(0,s+1),n.queue=a),a.push({redo:o,undo:r}),n.curr=s+1}};o({name:"redo",keyboard:"ctrl+y",execute(){return{redo(){const e=n.queue[n.curr+1];e&&(e.redo&&e.redo(),n.curr++)}}}}),o({name:"undo",keyboard:"ctrl+z",execute(){return{redo(){if(-1===n.curr)return;const e=n.queue[n.curr];e&&(e.undo&&e.undo(),n.curr--)}}}}),o({name:"drag",pushQueue:!0,init(){this.before=[];const e=()=>{this.before=(0,c.Z)(t.value.blocks)},o=()=>n.commands.drag();return p.on("start",e),p.on("end",o),()=>{p.off("start"),p.off("end")}},execute(){const e=this.before,n=t.value.blocks;return{redo(){t.value={...t.value,blocks:n}},undo(){t.value.blocks=[...e]}}}}),o({name:"updateContainer",pushQueue:!0,execute(e){let n={before:t.value,after:e};return{redo:()=>{t.value=n.after},undo:()=>{t.value=n.before}}}});const s=(()=>{const e={90:"z",89:"y"},t=t=>{const{ctrlKey:o,keyCode:r}=t;let s=[];o&&s.push("ctrl"),s.push(e[r]),s=s.join("+"),n.commandsArr.forEach((({keyboard:e,name:o})=>{e&&e===s&&(n.commands[o](),t.preventDefault())}))},o=()=>(window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)});return o})();return(()=>{n.destroyArr.push(s()),n.commandsArr.forEach((e=>e.init&&n.destroyArr.push(e.init())))})(),(0,r.Ah)((()=>{n.destroyArr.forEach((e=>e&&e()))})),n}const h=(0,r.aZ)({props:{option:{type:Object}},setup(e,t){const n=(0,l.qj)({isShow:!1,option:e.option});t.expose({showDialog(e){n.option=e,n.isShow=!0}});const s=()=>{n.isShow=!1},a=()=>{n.option.onConfirm(n.option.content),s()};return()=>(0,r.wy)((0,r.Wm)("div",{class:"modal"},[(0,r.Wm)("div",{class:"dialog-modal"},[(0,r.Wm)("header",{class:"header-modal"},[(0,r.Wm)("h2",{class:"tit"},[n.option.title]),(0,r.Wm)("span",{class:"close",onClick:s},[(0,r.Wm)("a",{href:"#",class:"bt"},null)])]),(0,r.Wm)("div",{class:"content-modal"},[(0,r.wy)((0,r.Wm)("textarea",{type:"text","onUpdate:modelValue":e=>n.option.content=e},null),[[o.nr,n.option.content]])]),(0,r.wy)((0,r.Wm)("footer",{class:"footer-modal"},[(0,r.Wm)("button",{onClick:a},[(0,r.Uk)("提交")])]),[[o.F8,n.option.hasFooter]])])]),[[o.F8,n.isShow]])}});let g;function b(e){if(!g){let t=document.createElement("div");g=(0,r.Wm)(h,{option:e}),document.body.appendChild(((0,o.sY)(g,t),t))}const{showDialog:t}=g.component.exposed;t(e)}var y=(0,r.aZ)({props:{modelValue:{type:Object}},emits:["update:modelValue"],components:{EditorBlock:i},setup(e,t){const n=(0,r.f3)("config"),o=(0,r.Fl)({get(){return e.modelValue},set(e){t.emit("update:modelValue",(0,c.Z)(e))}}),s=(0,r.Fl)((()=>({width:o.value.container.width+"px",height:o.value.container.height+"px"}))),a=(0,l.iH)(null),{dragstart:u,dragend:d}=f(a,o),{blcokMousedown:p,clearMousedown:h,markLine:g}=m(o),{commands:y}=v(o),w=[{label:"上一步",handler:()=>y.undo()},{label:"撤销上一步",handler:()=>y.redo()},{label:"导入JSON",handler:()=>{b({title:"导出完成",hasFooter:!0,onConfirm(e){y.updateContainer(JSON.parse(e))}})}},{label:"导出JSON",handler:()=>{b({title:"导出完成",content:JSON.stringify(o.value)})}}];return()=>(0,r.Wm)("div",{class:"editor"},[(0,r.Wm)("div",{class:"editor-left"},[n.componentList.map((e=>(0,r.Wm)("div",{class:"preview-item",draggable:!0,onDragstart:t=>u(t,e),onDragend:d},[(0,r.Wm)("span",{class:"name"},[e.label]),(0,r.Wm)("div",{class:"component"},[e.preview()])])))]),(0,r.Wm)("div",{class:"editor-top"},[w.map((e=>(0,r.Wm)("div",{class:"editor-top-button",onClick:e.handler},[(0,r.Wm)("span",null,[e.label])])))]),(0,r.Wm)("div",{class:"editor-right"},[(0,r.Uk)("右侧")]),(0,r.Wm)("div",{class:"editor-container"},[(0,r.Wm)("div",{class:"editor-canvas"},[(0,r.Wm)("div",{class:"editor-canvas-content",style:s.value,ref:a,onmousedown:h},[o.value.blocks.map(((e,t)=>(0,r.Wm)(i,{class:e.selected?"editor-block-selected":"",data:e,onmousedown:n=>p(n,e,t)},null))),null!==g.x&&(0,r.Wm)("div",{class:"line-x",style:{left:g.x+"px"}},null),null!==g.y&&(0,r.Wm)("div",{class:"line-y",style:{top:g.y+"px"}},null)])])])])}});function w(){const e=[],t={};return{componentList:e,componentMap:t,register:n=>{e.push(n),t[n.type]=n}}}const x=w();x.register({label:"文本",preview:()=>"预览文本",render:()=>"渲染文本",type:"text"}),x.register({label:"按钮",preview:()=>(0,r.Wm)("button",null,[(0,r.Uk)("预览按钮")]),render:()=>(0,r.Wm)("button",null,[(0,r.Uk)("渲染按钮")]),type:"button"}),x.register({label:"输入框",preview:()=>(0,r.Wm)("input",{placeholder:"预览输入框"},null),render:()=>(0,r.Wm)("input",{placeholder:"渲染输入框"},null),type:"input"});var k={components:{VisualEditor:y},setup(){const e=(0,l.iH)(u);return(0,r.JJ)("config",x),{state:e}}},W=n(89);const E=(0,W.Z)(k,[["render",a]]);var L=E;(0,o.ri)(L).mount("#app")}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var s=t[o]={exports:{}};return e[o].call(s.exports,s,s.exports,n),s.exports}n.m=e,function(){var e=[];n.O=function(t,o,r,s){if(!o){var a=1/0;for(c=0;c<e.length;c++){o=e[c][0],r=e[c][1],s=e[c][2];for(var l=!0,u=0;u<o.length;u++)(!1&s||a>=s)&&Object.keys(n.O).every((function(e){return n.O[e](o[u])}))?o.splice(u--,1):(l=!1,s<a&&(a=s));if(l){e.splice(c--,1);var i=r();void 0!==i&&(t=i)}}return t}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[o,r,s]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,o){var r,s,a=o[0],l=o[1],u=o[2],i=0;if(a.some((function(t){return 0!==e[t]}))){for(r in l)n.o(l,r)&&(n.m[r]=l[r]);if(u)var c=u(n)}for(t&&t(o);i<a.length;i++)s=a[i],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(c)},o=self["webpackChunkvisual_editor"]=self["webpackChunkvisual_editor"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=n.O(void 0,[998],(function(){return n(9717)}));o=n.O(o)})();